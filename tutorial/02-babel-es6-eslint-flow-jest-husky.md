# 02 - Babel, ES6, ESLint, Flow, Jest, and Husky

æœ¬ç« ä»£ç åœ¨ [è¿™é‡Œ](https://github.com/verekia/js-stack-walkthrough/tree/master/02-babel-es6-eslint-flow-jest-husky)ã€‚

æˆ‘ä»¬å°†åœ¨æœ¬ç« ä½¿ç”¨ ES6 è¯­æ³•ï¼Œä¸ ES5 è¯­æ³•ç›¸æ¯”ï¼Œå®ƒæ›´åŠ ä¼˜é›…ã€‚å‡ ä¹æ‰€æœ‰çš„æµè§ˆå™¨å’Œ JS ç¯å¢ƒéƒ½èƒ½ç†è§£ ES5ï¼Œä½† ES6 è¿˜æ²¡æœ‰å¾—åˆ°å¹¿æ³›æ”¯æŒã€‚ä¸ºæ­¤ï¼Œä¸€ä¸ªåä¸º Babel çš„å·¥å…·åº”è¿è€Œç”Ÿã€‚

## Babel

> ğŸ’¡ **[Babel](https://babeljs.io/)** æ˜¯ä¸€ä¸ªå°† ES6 ä»£ç  è½¬æ¢ä¸º ES5 ä»£ç çš„ç¼–è¯‘å™¨ï¼ˆä¸€äº›å…¶ä»–è¯­æ³•ï¼Œæ¯”å¦‚ JSX è¯­æ³•ä¹Ÿèƒ½å¤Ÿè¢«ç¼–è¯‘ï¼‰ã€‚ å®ƒéå¸¸æ¨¡å—åŒ–ï¼Œå¯è¢«è¿ç”¨äºå„ç§ [ç¯å¢ƒ](https://babeljs.io/docs/setup/)ã€‚ç›®å‰ä¸ºæ­¢ï¼Œå®ƒæ˜¯ React ç¤¾åŒºæœ€å—æ¨å´‡çš„ ES5 ç¼–è¯‘å™¨ã€‚

- æŠŠ `index.js` ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„ `src` æ–‡ä»¶å¤¹ä¸‹ã€‚ åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œä½¿ç”¨ ES6 è¯­æ³•ã€‚ åˆ é™¤å’Œ `color` æœ‰å…³çš„ä»£ç ï¼Œç”¨ä¸‹é¢çš„å†…å®¹æ›¿æ¢ï¼š

```js
const str = 'ES6'
console.log(`Hello ${str}`)
```

æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„ ES6 è¯­æ³•æ˜¯ *æ¨¡æ¿å­—ç¬¦ä¸²*ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨å­—ç¬¦ä¸²ä¸­é€šè¿‡ `${}` æ¥æ’å…¥å˜é‡ã€‚æ³¨æ„æ¨¡æ¿è¯­æ³•ä½¿ç”¨ **åå¼•å·**.

- è¿è¡Œ `yarn add --dev babel-cli` å®‰è£… Babel CLIï¼ˆå‘½ä»¤è¡Œå·¥å…·ï¼‰ã€‚

Babel CLI æœ‰ [ä¸¤ç§æ‰§è¡Œæ–¹å¼](https://babeljs.io/docs/usage/cli/): `babel`ï¼Œå°† ES6 æ–‡ä»¶è½¬æ¢ä¸º ES5 æ–‡ä»¶ï¼› `babel-node` å¯ä»¥æ›¿æ¢ `node`ï¼Œç”¨æ¥è½»é‡çº§åœ°ç›´æ¥æ‰§è¡Œ ES6 æ–‡ä»¶ã€‚ `babel-node` é€‚ç”¨äºå¼€å‘ï¼Œä½†å¯¹äºç”Ÿäº§ç¯å¢ƒæ¥è¯´ï¼Œå®ƒå¤ªç¬¨é‡äº†ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `babel-node` æ¥é…ç½®å¼€å‘ç¯å¢ƒï¼›æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `babel` æ¥ä¸ºç”Ÿäº§ç¯å¢ƒæ‰“åŒ… ES5 æ–‡ä»¶ã€‚

- åœ¨ `package.json`  `start` è„šæœ¬ä¸­, ç”¨ `babel-node src` æ¥æ›¿æ¢ `node .` (`index.js` æ˜¯ Node é»˜è®¤æ‰§è¡Œçš„æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥çœç•¥ `index.js`)ã€‚

å¦‚æœä½ ç°åœ¨è¿è¡Œ `yarn start` ï¼Œè¾“å‡ºåº”è¯¥æ²¡å•¥é—®é¢˜ï¼›ä¸è¿‡ Babel è¿™æ—¶å€™å¹¶èµ·åˆ°ä»€ä¹ˆä½œç”¨ã€‚å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å‘Šè¯‰ Babel è¿›è¡Œä½•ç§è½¬æ¢ã€‚è¾“å‡ºæ­£ç¡®çš„å”¯ä¸€åŸå› æ˜¯ Node åŸç”Ÿæ”¯æŒäº† ES6 è¯­æ³•ã€‚ç„¶è€Œï¼ŒæŸäº›æµè§ˆå™¨ä»¥åŠè€ç‰ˆæœ¬çš„ Node å´ä¸ä¸€å®šæ”¯æŒè¿™äº›æœ€æ–°çš„è¯­æ³•ã€‚

- è¿è¡Œ `yarn add --dev babel-preset-env` æ¥å®‰è£…ä¸€ä¸ªå« `env` çš„ Babel preset åŒ…ï¼Œå®ƒåŒ…å«äº†å¤§éƒ¨åˆ† Babel æ”¯æŒè½¬åŒ–çš„ ECMAScript è¯­æ³•é…ç½®ã€‚

- åœ¨æ ¹ç›®å½•åˆ›å»º `.babelrc` æ–‡ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨æ¥é…ç½® Babel çš„ JSON æ–‡ä»¶ã€‚ æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œä½¿ Babel ä½¿ç”¨ `env` presetï¼š

```json
{
  "presets": [
    "env"
  ]
}
```

ğŸ `yarn start` ç°åœ¨èƒ½å¤Ÿè¿è¡ŒæˆåŠŸï¼Œå¹¶ä¸” Babel ç¡®å®èµ·äº†ç‚¹ä½œç”¨ã€‚ä½†æ˜¯ä¸ºäº†è½»é‡å¼€å‘ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `babel-node`ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜ä¸èƒ½ææ¸…æ¥š Babel åˆ°åº•å¹²äº†ä»€ä¹ˆã€‚ ä¸è¿‡ï¼Œå½“ä½ è¯»åˆ°è¿™ä¸€èŠ‚ [ES6 æ¨¡å—è¯­æ³•](#the-es6-modules-syntax) æ—¶ï¼Œä½ å°±ä¼šæ˜ç™½ Babel çš„ä½œç”¨äº†ã€‚

## ES6

> ğŸ’¡ **[ES6](http://es6-features.org/)**: ES6 æ˜¯ JavaScript æœ€æŒ¯å¥‹äººå¿ƒçš„æ›´æ–°ã€‚ES6 æ–°è¯­æ³•å¤ªå¤šï¼Œæˆ‘ä»¬ä¸å¯èƒ½å®Œæ•´åœ°ç½—åˆ—åœ¨è¿™é‡Œï¼›ä¸è¿‡ï¼Œæˆ‘ä»¬ä¼šç®€å•åœ°ä»‹ç»ä¸€ä¸‹ `class`ï¼Œ `const` ï¼Œ `let`ï¼Œ å­—ç¬¦ä¸²è¯­æ³•ä»¥åŠç®­å¤´å‡½æ•° (`(text) => { console.log(text) }`)ã€‚

### åˆ›å»º ES6 class

- åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ `src/dog.js`ï¼Œä½¿ç”¨ ES6 class è¯­æ³•ï¼š

```js
class Dog {
  constructor(name) {
    this.name = name
  }

  bark() {
    return `Wah wah, I am ${this.name}`
  }
}

module.exports = Dog
```

å¦‚æœä½ ä¹‹å‰ç”¨è¿‡é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä¸Šé¢çš„ä»£ç å¯¹ä½ æ¥è¯´åº”è¯¥å¹¶ä¸é™Œç”Ÿã€‚ä½†å¯¹ JavaScript æ¥è¯´ï¼Œè¿™ç§è¯­æ³•ç¡®å®æŒºæ–°å¥‡çš„ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªç±»èµ‹å€¼ç»™ `module.exports`ï¼Œå°±å¯¼å‡ºäº†å®ƒã€‚

åœ¨ `src/index.js` æ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```js
const Dog = require('./dog')

const toby = new Dog('Toby')

console.log(toby.bark())
```

æ³¨æ„ï¼Œä½¿ç”¨æˆ‘ä»¬è‡ªå·±å†™çš„åŒ…ï¼Œå’Œä½¿ç”¨ç¤¾åŒºæä¾›çš„åŒ… `color` æ—¶ï¼Œå¼•ç”¨åŒ…çš„æ–¹å¼æ˜¯ä¸ä¸€æ ·çš„ã€‚å½“å¼•ç”¨æˆ‘ä»¬è‡ªå·±çš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬åœ¨ `require()` ä¸­ï¼Œä½¿ç”¨çš„æ˜¯ç›¸å¯¹è·¯å¾„ `./`ã€‚

ğŸ è¿è¡Œ `yarn start`ï¼Œæ­£ç¡®è¾“å‡º "Wah wah, I am Toby"ã€‚

### ES6 æ¨¡å—è¯­æ³•

æˆ‘ä»¬å°†ç”¨ `import Dog from './dog'` æ¥æ›¿æ¢ `const Dog = require('./dog')`ï¼Œè¿™æ˜¯æœ€æ–°çš„ ES6 æ¨¡å—è¯­æ³•(å’Œ "CommonJS" æ¨¡å—ä¸æ³•ç›¸å¯¹åº”)ã€‚ä½†ç°åœ¨ NodeJS è¿˜å¹¶ä¸æ”¯æŒè¿™ç§è¯­æ³•ï¼Œæ‰€ä»¥å¦‚æœä»£ç ä»èƒ½æ­£å¸¸è¿è¡Œçš„è¯ï¼Œå°±è¯´æ˜ Babel ç¡®å®æ­£ç¡®å¤„ç†äº†æˆ‘ä»¬çš„ä»£ç ã€‚

åŒæ—¶ï¼Œåœ¨ `dog.js` æ–‡ä»¶ä¸­, ç”¨ `export default Dog` æ›¿æ¢ `module.exports = Dog` ã€‚

ğŸ `yarn start` åº”è¯¥èƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œå¹¶è¾“å‡º "Wah wah, I am Toby"ã€‚

## ESLint

> ğŸ’¡ **[ESLint](http://eslint.org)** æ˜¯ ES6 ä»£ç çš„æ£€æŸ¥å™¨ã€‚å®ƒä¼šæ ¹æ®ä»£ç è§„èŒƒï¼Œç»™å‡ºåˆç†çš„æç¤ºã€‚ESLint ç»™å‡ºçš„æç¤ºï¼Œä¹Ÿèƒ½å¸®ä½ æ›´å¥½åœ°å­¦ä¹  JavaScriptã€‚

ESLint éœ€è¦å’Œå„ç§ *è§„èŒƒ* ç»“åˆä½¿ç”¨ï¼Œ[è§„èŒƒ](http://eslint.org/docs/rules/) å¯ä¸å°‘å“¦ã€‚æˆ‘é€‰æ‹©çš„æ˜¯ Airbnb æä¾›çš„ä»£ç è§„èŒƒã€‚ä¸ºäº†ä½¿ç”¨è§„èŒƒï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®‰è£…ä¸€äº›æ’ä»¶ã€‚

æŸ¥é˜… Airbnb æœ€æ–° [è¯´æ˜](https://www.npmjs.com/package/eslint-config-airbnb)ï¼Œå®‰è£…é…ç½®åŒ…ä»¥åŠå®ƒçš„ä¾èµ–åŒ…ã€‚ æˆªè‡³ 2017-02-03, Airbnb å»ºè®®ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¡Œï¼š

```sh
npm info eslint-config-airbnb@latest peerDependencies --json | command sed 's/[\{\},]//g ; s/: /@/g' | xargs yarn add --dev eslint-config-airbnb@latest
```

è¿™æ¡å‘½ä»¤èƒ½å®‰è£…å¥½æ‰€æœ‰éœ€è¦çš„åŒ…ï¼Œå¹¶ä¸”åœ¨ `package.json` æ–‡ä»¶ä¸­è‡ªåŠ¨æ·»åŠ äº† `eslint-config-airbnb`ï¼Œ `eslint-plugin-import`ï¼Œ `eslint-plugin-jsx-a11y` ä»¥åŠ `eslint-plugin-react` ã€‚

**æ³¨æ„**: æˆ‘æŠŠå‘½ä»¤ä¸­çš„ `npm install` æ›¿æ¢ä¸º `yarn add`ï¼Œç„¶è€Œï¼ŒWindows ç³»ç»Ÿå¹¶ä¸æ”¯æŒã€‚æ‰€ä»¥å¦‚æœä½ é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œè¯·æŸ¥çœ‹ `package.json` æ–‡ä»¶ï¼Œç„¶åç”¨ `yarn add --dev packagename@^#.#.#` æ¥æ‰‹åŠ¨å®‰è£…æ‰€éœ€è¦çš„åŒ…ã€‚ `#.#.#` ä»£è¡¨ `package.json` æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬å·ã€‚

- é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»º `.eslintrc.json`ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š

```json
{
  "extends": "airbnb"
}
```

ä¸ºäº†ä½¿ç”¨ `eslint` å‘½ä»¤è¡Œï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…è¿™ä¸ªåŒ…ï¼š

- è¿è¡Œ `yarn add --dev eslint`

ä¿®æ”¹ `package.json` çš„ `scripts` ï¼Œæ·»åŠ ä¸€ä¸ª `test` ä»»åŠ¡ï¼š

```json
"scripts": {
  "start": "babel-node src",
  "test": "eslint src"
},
```

è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯æ£€æµ‹ `src` ç›®å½•ä¸‹æ‰€æœ‰çš„ JS æ–‡ä»¶ã€‚

æˆ‘ä»¬ä¼šç”¨ `test` ä»»åŠ¡è¿è¡Œä¸€ç³»åˆ—å‘½ä»¤æ¥éªŒè¯æˆ‘ä»¬çš„ä»£ç ï¼ŒåŒ…æ‹¬ä¹‹åçš„ç±»å‹æ£€æŸ¥å’Œå•å…ƒæµ‹è¯•ã€‚

- è¿è¡Œ `yarn test`ï¼Œä½ åº”è¯¥çœ‹åˆ° `index.js` æ–‡ä»¶ä¸­çš„é”™è¯¯æœ‰ï¼šåˆ†å·ç¼ºå¤±ï¼Œä½¿ç”¨ `console.log()` ã€‚è¯¥æ–‡ä»¶é¡¶éƒ¨æ·»åŠ  `/* eslint-disable no-console */` æ¥å…è®¸æˆ‘ä»¬åœ¨è¯¥æ–‡ä»¶ä¸­ä½¿ç”¨ `console` ã€‚

**æ³¨æ„**: å¦‚æœä½ æ˜¯ Windows ç³»ç»Ÿç”¨æˆ·ï¼Œè¯·ä¿è¯ä½ å·²ç»è®¾ç½®ä½ çš„ Git å’Œç¼–è¾‘å™¨ä½¿ç”¨ Unix çš„ LF æ¢è¡Œæ¨¡å¼ï¼Œè€Œä¸æ˜¯ Windows é»˜è®¤çš„ CRLF æ¢è¡Œæ¨¡å¼ã€‚å¦‚æœä½ çš„é¡¹ç›®åªä¼šè·‘åœ¨ Windows ä¸Šï¼Œä½ å¯ä»¥åœ¨ ESLint é…ç½®æ–‡ä»¶çš„ `rules` ä¸­æ·»åŠ  `"linebreak-style": [2, "windows"]` æ¥å¼ºåˆ¶ä½¿ç”¨ CRLF æ¢è¡Œæ¨¡å¼ã€‚

### åˆ†å·

è¿™å¯èƒ½æ˜¯ JS ç¤¾åŒºä¸­æœ€å®¹æ˜“å¼•èµ·æ’•é€¼çš„è¯é¢˜äº†ï¼Œæˆ‘ä»¬ä¹Ÿæ¥å” å” ã€‚å› ä¸º JS çš„è‡ªåŠ¨åˆ†å·æ’å…¥æœºåˆ¶ï¼Œä½ å¯ä»¥çœç•¥åˆ†å·ã€‚æˆ‘è§‰å¾—è¿™ä¸ªé—®é¢˜åªå…³ä¸ªäººå–œå¥½ï¼Œè€Œæ— å…³å¯¹é”™ã€‚å¦‚æœä½ å–œæ¬¢ Pythonï¼Œ Rubyï¼Œ æˆ–è€… Scalaï¼Œä½ å¯èƒ½æŒºäº«å—çœç•¥åˆ†å·çš„å†™æ³•ã€‚ ä½†è¦æ˜¯ä½ å–œæ¬¢çš„æ˜¯ Javaï¼Œ C#ï¼Œ æˆ–è€… PHPï¼Œé‚£ä½ åº”è¯¥æ›´å–œæ¬¢åŠ ä¸Šåˆ†å·ã€‚

å¤§å¤šæ•°äººå‡ºäºä¹ æƒ¯ä¼šåœ¨å†™ JS çš„æ—¶å€™åŠ ä¸Šåˆ†å·ã€‚æœ€å¼€å§‹æˆ‘ä¹Ÿæ˜¯åˆ†å·å…šï¼Œç›´åˆ°æœ‰ä¸€å¤©æˆ‘çœ‹äº† Redux æ–‡æ¡£ä¸­çš„ä»£ç ç¤ºä¾‹ï¼Œç„¶åå°è¯•äº†ä¸€ä¸‹ä¸å†™åˆ†å·ã€‚åˆšå¼€å§‹çš„æ„Ÿè§‰æœ‰ç‚¹å¥‡æ€ªï¼Œä½†åªæ˜¯å› ä¸ºä¸ä¹ æƒ¯ï¼›ä¸è¿‡åœ¨å†™äº†ä¸€å¤©ä»£ç åï¼Œæˆ‘å°±å˜æˆäº†ä¸€ä¸ªä¸æŠ˜ä¸æ‰£çš„æ— åˆ†å·å…šã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä¸å†™åˆ†å·æ›´ç›´è§‚ï¼Œå†™èµ·æ¥ä¹Ÿæ›´ç®€å•ã€‚

æˆ‘å»ºè®®ä½ è¯»ä¸€ä¸‹ [å…³äºåˆ†å·çš„ ESLint æ–‡æ¡£](http://eslint.org/docs/rules/semi)ã€‚æ­£å¦‚åœ¨æ–‡æ¡£ä¸­æåˆ°çš„ï¼Œå¦‚æœä½ ä¹Ÿæƒ³æˆä¸ºä¸€ä¸ªæ— åˆ†å·å…šï¼Œä½ åº”è¯¥çŸ¥é“åœ¨ä¸€äº›æç«¯æƒ…å†µä¸‹ï¼Œåˆ†å·åˆæ˜¯å¿…è¦çš„ã€‚ ESLint èƒ½å¤Ÿå¸®åŠ©ä½ åº”å¯¹è¿™äº›æç«¯æƒ…å†µã€‚ä½ éœ€è¦åœ¨ `.eslintrc.json` ä¸­æ·»åŠ  `no-unexpected-multiline` è§„åˆ™ï¼š

```json
{
  "extends": "airbnb",
  "rules": {
    "semi": [2, "never"],
    "no-unexpected-multiline": 2
  }
}
```

ğŸ ç°åœ¨å†è¿è¡Œ `yarn test`ï¼Œå°±åº”è¯¥æ²¡ä»€ä¹ˆé”™è¯¯æç¤ºäº†ã€‚åœ¨ä¸éœ€è¦åˆ†å·çš„åœ°æ–¹åŠ ä¸€ä¸‹åˆ†å·ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰é”™è¯¯æç¤ºã€‚

å¦‚æœä½ ä»¬åšæŒä½¿ç”¨åˆ†å·ï¼Œæˆ‘è¡¨ç¤ºç†è§£ï¼›ä¸è¿‡ï¼Œè¿™å¯èƒ½è®©ä½ ä»¬åœ¨ä½¿ç”¨è¿™ä¸ªæ•™ç¨‹çš„æ—¶å€™ä¸å¤ªæ–¹ä¾¿ã€‚å¦‚æœä½ çœ‹è¿™ä¸ªæ•™ç¨‹åªæ˜¯ä¸ºäº†å­¦ä¹ ä¸€ä¸‹ï¼Œé‚£æˆ‘ä¿è¯ä½ åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¸ä½¿ç”¨åˆ†å·ï¼Œæ˜¯å¯ä»¥å¿ä¸€å¿çš„ï¼›å¦‚æœä½ æƒ³ç”¨æ•™ç¨‹æä¾›çš„æ¨¡æ¿å¹¶ä¸”æ˜¯ä¸ªåˆ†å·å…šï¼Œä½ å¯èƒ½è¦åœ¨æŸäº›åœ°æ–¹åšäº›ä¿®æ”¹ â€”â€” æœ‰äº† ESLint çš„æç¤ºï¼Œä½ æ”¹å¾—åº”è¯¥ä¹ŸæŒºå¿«çš„ã€‚

### Compat

å¦‚æœä½ æƒ³è®©ä½ çš„é¡¹ç›®æ”¯æŒæ›´å¤šçš„æµè§ˆå™¨ï¼Œä½†ä¸çŸ¥é“è¦æ”¯æŒçš„æµè§ˆå™¨æ˜¯å¦æ”¯æŒæŸä¸ª API æ€ä¹ˆåŠï¼Ÿç”¨ [Compat](https://github.com/amilajack/eslint-plugin-compat)ï¼è¯·æŸ¥çœ‹æ ¹æ® [Can I Use](http://caniuse.com/) åˆ¶å®šçš„ [æµè§ˆå™¨åˆ—è¡¨](https://github.com/ai/browserslist)

- è¿è¡Œ `yarn add --dev eslint-plugin-compat`

- åœ¨ `package.json` ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œå‘Šè¯‰æ’ä»¶ï¼Œåªè¦æ˜¯å¸‚åœºå æœ‰ç‡è¶…è¿‡ç™¾åˆ†ä¹‹ä¸€çš„æµè§ˆå™¨ï¼Œæˆ‘ä»¬éƒ½æƒ³æ”¯æŒã€‚

```json
"browserslist": ["> 1%"],
```

- ç›¸åº”çš„ï¼Œ`.eslintrc.json` æ–‡ä»¶ä¹Ÿè¦åšå‡ºä¿®æ”¹ï¼š

```json
{
  "extends": "airbnb",
  "plugins": [
    "compat"
  ],
  "rules": {
    "semi": [2, "never"],
    "no-unexpected-multiline": 2,
    "compat/compat": 2
  }
}
```

ä¸ºäº†è¯•è¯•æ’ä»¶å¥½ä¸å¥½ç”¨ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨ `navigator.serviceWorker` æˆ– `fetch` ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œ ESLint è¿™æ—¶å€™ä¼šç»™å‡ºé”™è¯¯æç¤ºã€‚

### ç¼–è¾‘å™¨ä¸­çš„ ESLint

æœ¬ç« ä¸­æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­é…ç½®äº† ESLintï¼Œåœ¨æ„å»ºä»£ç æˆ–æäº¤ä»£ç çš„æ—¶å€™ï¼Œä¼šå¾—åˆ°é”™è¯¯æç¤ºã€‚å…¶å®ï¼Œä½ ä¹Ÿå¯ä»¥è®©ä½ çš„ IDE ä½¿ç”¨ä½ çš„é…ç½®ï¼Œè¿™æ ·ä½ å°±èƒ½å¾—åˆ°æ›´åŠæ—¶çš„é”™è¯¯åé¦ˆäº†ã€‚åˆ«ä½¿ç”¨ IDE åŸç”Ÿçš„ ES6 é”™è¯¯æç¤ºï¼é€šè¿‡ç›¸åº”çš„é…ç½®ï¼Œè®©ç¼–è¾‘å™¨ä½¿ç”¨ä½ æŒ‡å®šçš„åŒ…ï¼›è¿™æ ·ï¼Œä½ æ‰èƒ½åœ¨ä½¿ç”¨å…¶ä»–çš„ç¼–è¾‘å™¨æ—¶ï¼Œå¾—åˆ°åŒæ ·çš„æç¤ºã€‚

ï¼ˆè¯‘è€…æ³¨ï¼šå¦‚æœä½ çš„ç¼–è¾‘å™¨æ˜¯ Atom å¹¶ä¸”å®‰è£…äº† lint æ’ä»¶ï¼Œé‚£ä¹ˆåœ¨é…ç½®å®Œä¹‹åï¼Œç¼–è¾‘å™¨ä¼šè‡ªåŠ¨æ ¹æ® `.eslintrc.json` ä¸­çš„é…ç½®æ¥æ£€æµ‹ä»£ç ï¼›åˆæ¬¡ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œå¯èƒ½ä¸ä¼šæ£€æµ‹ï¼Œå¯ä»¥å°è¯•é‡å¯ Atomï¼‰

## Flow

> ğŸ’¡ **[Flow](https://flowtype.org/)**: Facebook æä¾›çš„ä¸€ä¸ªé™æ€ç±»å‹æ£€æŸ¥å™¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æŠŠä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼èµ‹å€¼ç»™ä¸€ä¸ªæ•°å€¼ç±»å‹çš„å˜é‡ï¼Œå®ƒå°±ä¼šæŠ¥é”™ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬çš„ JS ä»£ç æ˜¯æ ‡å‡†çš„ ES6 æ ¼å¼ã€‚Flow èƒ½å¤Ÿæ£€æŸ¥è¿™æ ·çš„ä»£ç ï¼Œä½†ä¸ºäº†å‘æŒ¥å®ƒçš„æœ€å¤§å¨åŠ›ï¼Œæˆ‘ä»¬è¦åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­åŠ å…¥æ³¨é‡Šï¼›ä½†è¿™æ ·ï¼Œæˆ‘ä»¬çš„ä»£ç å°±ä¸é‚£ä¹ˆç¬¦åˆæ ‡å‡†äº†ã€‚ä¸ºäº†è®© Babel å’Œ ESLint åœ¨è§£ææˆ‘ä»¬çš„ä»£ç æ—¶ä¸å´©æºƒï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡é…ç½®è®©å®ƒä»¬ç†è§£æ³¨é‡Šã€‚

- è¿è¡Œ `yarn add --dev flow-bin babel-preset-flow babel-eslint eslint-plugin-flowtype`

`flow-bin` æ˜¯åœ¨ `scripts` ä»»åŠ¡ä¸­ç”¨çš„, `babel-preset-flow` å¸®åŠ© Babel ç†è§£ Flow æ³¨é‡Šï¼Œ `babel-eslint` è®© ESLint *ä¾èµ–äº Babel è§£æå™¨*ï¼Œ `eslint-plugin-flowtype` æ˜¯ä¸€ä¸ªç”¨æ¥æ£€æŸ¥æ³¨é‡Šé”™è¯¯çš„ ESLint æ’ä»¶ã€‚

- åƒä¸‹é¢è¿™æ ·ä¿®æ”¹ `.babelrc` æ–‡ä»¶ï¼š

```json
{
  "presets": [
    "env",
    "flow"
  ]
}
```

- `.eslintrc.json` ä¹Ÿå¾—æ”¹ï¼š

```json
{
  "extends": [
    "airbnb",
    "plugin:flowtype/recommended"
  ],
  "plugins": [
    "flowtype",
    "compat"
  ],
  "rules": {
    "semi": [2, "never"],
    "no-unexpected-multiline": 2,
    "compat/compat": 2
  }
}
```

**æ³¨æ„**: `plugin:flowtype/recommended` å·²ç»å‘Šè¯‰ Babel è¯¥ç”¨ä»€ä¹ˆè§£æå™¨äº†ï¼›ä¸è¿‡ï¼Œè¦æ˜¯ä½ æƒ³æ›´æ˜ç¡®ç‚¹ï¼Œå¯ä»¥åœ¨ `.eslintrc.json` åŠ ä¸Š `"parser": "babel-eslint"` ã€‚

è¿™ä¸€èŠ‚çš„ä¸œè¥¿å¥½åƒæœ‰ç‚¹å¤šï¼Œä½ å¯ä»¥å…ˆèŠ±å‡ åˆ†é’Ÿæ¶ˆåŒ–ä¸€ä¸‹ã€‚æˆ‘åˆ°ç°åœ¨è¿˜æ„Ÿåˆ°å¾ˆæƒŠå¥‡ï¼ŒESLint ç«Ÿç„¶èƒ½ç”¨ Babel çš„è§£æå™¨æ¥è§£æ Flow çš„æ³¨é‡Šï¼è¿™ä¿©å·¥å…·å®åœ¨æ˜¯å¤ªæ¨¡å—åŒ–äº†ã€‚

- æŠŠ `flow` åŠ å…¥åˆ° `test` ä»»åŠ¡ï¼š

```json
"scripts": {
  "start": "babel-node src",
  "test": "eslint src && flow"
},
```

- æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `.flowconfig` æ–‡ä»¶ï¼š

```flowconfig
[options]
suppress_comment= \\(.\\|\n\\)*\\flow-disable-next-line
```

å¦‚æœä½ æƒ³è®© Flow å¿½ç•¥ä¸‹ä¸€è¡Œä»£ç ï¼Œä½ å¯ä»¥ç”¨ä¸Šé¢çš„æ³¨é‡Šæ–¹æ³•ï¼›å®ƒçš„ç”¨æ³•å’Œ `eslint-disable` å¾ˆåƒï¼š

```js
// flow-disable-next-line
something.flow(doesnt.like).for.instance()
```

é…ç½®éƒ¨åˆ†å·®ä¸å¤šå¯ä»¥å‘Šä¸€æ®µè½äº†ã€‚

- åœ¨ `src/dog.js` åŠ å…¥æ³¨é‡Šï¼š

```js
// @flow

class Dog {
  name: string

  constructor(name: string) {
    this.name = name
  }

  bark() {
    return `Wah wah, I am ${this.name}`
  }
}

export default Dog
```

`// @flow` æ³¨é‡Šå‘Šè¯‰ Flowï¼š è¿™ä¸ªæ–‡ä»¶éœ€è¦è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬çš„æ³¨é‡ŠåŸºæœ¬ä¸Šå°±æ˜¯åœ¨å‚æ•°æˆ–æ–¹æ³•åååŠ ä¸€ä¸ªå†’å·ï¼Œå…³äº Flow æ³¨é‡Šçš„æ›´å¤šä½¿ç”¨æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹ [æ–‡æ¡£](https://flowtype.org/docs/quick-reference.html) ã€‚

- åœ¨ `index.js` æ–‡ä»¶é‡Œä¹ŸåŠ ä¸Š  `// @flow` ã€‚

`yarn test` ç°åœ¨ä¸å…‰è¿›è¡Œè§„èŒƒæ£€æŸ¥ï¼Œè¿˜è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚

ä½ å¯ä»¥è¿›è¡Œä¸‹é¢çš„å°è¯•ï¼š

- åœ¨ `dog.js` æ–‡ä»¶ä¸­ï¼Œæ›¿æ¢ `constructor(name: string)` ä¸º `constructor(name: number)`ï¼Œ ç„¶åè¿è¡Œ `yarn test`ã€‚å¦‚æœ **Flow** æç¤ºç±»å‹å‡ºé”™ï¼Œé‚£è¯´æ˜ Flow è¿è¡ŒæˆåŠŸäº†ã€‚

- æ›¿æ¢ `constructor(name: string)` ä¸º `constructor(name:string)`ï¼Œè¿è¡Œ `yarn test`ã€‚å¦‚æœ  **ESLint** è¿è¡ŒæˆåŠŸåœ°è¯ï¼Œå®ƒä¼šæç¤ºä½ åœ¨å†’å·åæ·»åŠ ä¸€ä¸ªç©ºæ ¼ã€‚

ğŸ å¦‚æœä½ èƒ½å¾—åˆ°ä»¥ä¸Šä¸¤ä¸ªé”™è¯¯ï¼Œé‚£è¯´æ˜ä½ çš„ ESLint å’Œ Flow é…ç½®æˆåŠŸäº†ï¼›è®°å¾—æŠŠåˆšåˆšä¿®æ”¹çš„ä¸œè¥¿æ”¹å›å»ã€‚

### åœ¨ç¼–è¾‘å™¨ä¸­é…ç½® Flow

å’Œ ESLint ä¸€æ ·ï¼Œä½ ä¹Ÿåº”è¯¥åœ¨ä½ çš„ç¼–è¾‘å™¨ä¸­é…ç½® Flowï¼Œä»è€Œå¾—åˆ°åŠæ—¶åé¦ˆã€‚

## Jest

> ğŸ’¡ **[Jest](https://facebook.github.io/jest/)**: Facebook æä¾›çš„ä¸€ä¸ª JS æµ‹è¯•åº“ï¼Œé…ç½®ç®€å•ï¼Œä¸€æ­¥åˆ°ä½ï¼Œç”šè‡³è¿˜èƒ½ç”¨æ¥æµ‹è¯• React ç»„ä»¶ã€‚

- è¿è¡Œ `yarn add --dev jest babel-jest` å®‰è£… Jest ä»¥åŠå¯¹åº”çš„ Babel åŒ…ã€‚

- åœ¨ `.eslintrc.json` åŠ å…¥å¦‚ä¸‹å†…å®¹ä¹‹åï¼Œä½ å°±ä¸ç”¨å†åœ¨æµ‹è¯•æ–‡ä»¶é‡Œå¼•ç”¨ Jest åŒ…äº†ã€‚

```json
"env": {
  "jest": true
}
```

- åˆ›å»º `src/dog.test.js` æ–‡ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

```js
import Dog from './dog'

test('Dog.bark', () => {
  const testDog = new Dog('Test')
  expect(testDog.bark()).toBe('Wah wah, I am Test')
})
```

- æŠŠ `jest` æ·»åŠ åˆ° `test` ä»»åŠ¡ï¼š

```json
"scripts": {
  "start": "babel-node src",
  "test": "eslint src && flow && jest --coverage"
},
```

`--coverage` è®© Jest è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡ä¿¡æ¯ã€‚è§‚å¯Ÿè¦†ç›–ç‡ä¿¡æ¯ï¼Œå°±èƒ½çŸ¥é“å“ªäº›æ–‡ä»¶ç¼ºä¹æµ‹è¯•äº†ã€‚è¦†ç›–ç‡ä¿¡æ¯ä¿å­˜åœ¨ `coverage` æ–‡ä»¶å¤¹ä¸‹ã€‚

- æŠŠ `/coverage/` æ·»åŠ åˆ° `.gitignore`

ğŸ è¿è¡Œ `yarn test`ï¼Œåœ¨è§„èŒƒæ£€æµ‹å’Œç±»å‹æ£€æµ‹ä¹‹åï¼Œå®ƒåº”è¯¥ä¼šè¿›è¡Œè¦†ç›–ç‡æµ‹è¯•å¹¶å±•ç¤ºè¦†ç›–ç‡è¡¨ï¼Œå› ä¸ºæµ‹è¯•é€šè¿‡ï¼Œå±•ç¤ºçš„ç»“æœåº”è¯¥æ˜¯ç»¿è‰²çš„ã€‚

## ç”¨ Husky æ·»åŠ  Git é’©å­

> ğŸ’¡ **[Git Hooks](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)**: åœ¨ç‰¹å®šæ“ä½œï¼ˆä¾‹å¦‚ push æˆ–è€… commit æ“ä½œï¼‰å‰ä¼šè¢«æ‰§è¡Œçš„æ“ä½œã€‚

ç›®å‰ï¼Œ`test` ä»»åŠ¡å¸®åŠ©æˆ‘ä»¬è¿›è¡Œä»£ç æµ‹è¯•ï¼›ä¸ºäº†é¿å…å‘ä»£ç ä»“åº“ä¸­æäº¤åƒåœ¾ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸€æ¬¡ `git commit` å’Œ `git push` å‰ï¼Œè‡ªåŠ¨æ£€æµ‹ä»£ç ã€‚

[Husky](https://github.com/typicode/husky) ä¸€ä¸ªä¾¿æ·çš„è®¾ç½® Git é’©å­çš„åŒ…ã€‚

- è¿è¡Œ `yarn add --dev husky`

æˆ‘ä»¬åªéœ€è¦åœ¨ `scripts` æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ â€”â€” `precommit` å’Œ `prepush`ï¼š

```json
"scripts": {
  "start": "babel-node src",
  "test": "eslint src && flow && jest --coverage",
  "precommit": "yarn test",
  "prepush": "yarn test"
},
```

ğŸ ç°åœ¨è¯•ç€ commit æˆ–è€… push ä»£ç ï¼Œ `test` ä»»åŠ¡å°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚

å¦‚æœè¿è¡Œå‡ºé”™ï¼Œé‚£ä¸€èˆ¬æ˜¯å› ä¸º `yarn add --dev husky` è¿™ä¸ªå‘½ä»¤æ²¡æœ‰æ­£ç¡®å®‰è£… Git é’©å­ã€‚æˆ‘è‡ªå·±æ²¡é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼Œä½†å…¶ä»–è¿æ°”ä¸æ€ä¹ˆå¥½çš„äººé‡åˆ°è¿‡ã€‚ å¦‚æœä½ æ˜¯ä¸å¹¸è€…ä¹‹ä¸€ï¼Œè¯•è¯• `yarn add --dev husky --force`, å¯ä»¥çš„è¯ï¼Œè®°å¾—åœ¨è¿™é‡Œè¯´æ˜ä¸€ä¸‹ä½ çš„çŠ¶å†µ [this issue](https://github.com/typicode/husky/issues/84)ã€‚

**æ³¨æ„**ï¼šå¦‚æœä½ æ˜¯åœ¨ commit ä¹‹åæ‰§è¡Œ push æ“ä½œï¼Œä¸ºäº†é¿å…é‡å¤æµ‹è¯•ï¼Œä½ åº”è¯¥ä½¿ç”¨ `git push --no-verify` å‘½ä»¤ã€‚

ä¸‹ä¸€ç« ï¼š [03 - Express, Nodemon, PM2](03-express-nodemon-pm2.md#readme)

å›åˆ° [ä¸Šä¸€ç« ](01-node-yarn-package-json.md#readme) æˆ–è€… [ç›®å½•](https://github.com/verekia/js-stack-from-scratch#table-of-contents).
